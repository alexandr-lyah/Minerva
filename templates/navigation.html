{% load base_extra %}
<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container-fluid">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a>
      <a class="brand" href="{% url bulletin %}">Mynodo</a>
      <div class="nav-collapse">
        <ul class="nav">
          {% if user.is_authenticated %}
          <li class="{% active request 'bulletin' %}">
            <a href="{% url bulletin %}"><i class="icon-list-alt icon-white"></i> Bulletin</a>
          </li>
          <li class="{% active request 'people' %}">
            <a href="{% url people %}"><i class="icon-user icon-white"></i> People</a>
          </li>
          {% if user.is_staff %} <li class="divider-vertical"></li>
          <li>
            <a href="{% url bulletin %}admin" target="_blank"><i class="icon-heart icon-white"></i> Admin Panel</a>
          </li>
          {% endif %}
          {% endif %}
        </ul>
        <ul class="nav pull-right">
          <li class="">
            <a data-toggle="modal" href="#report" rel="popover" data-placement="bottom" data-content="We are still under development! Please let us know if you have any feedbacks, suggestions, concerns or problems you have found regarding this website!" data-original-title="File A Report"><i class="icon-exclamation-sign icon-white"></i> Report</a>
          </li>
          <li class="divider-vertical"></li>
          {% if not user.is_authenticated %}
          <li class="{% active request 'login' %}">
            <a href="{% url login %}"><i class="icon-share-alt icon-white"></i> Login</a>
          </li>
          <li class="divider-vertical"></li>
          <li class="{% active request 'signup' %}">
            <a href="{% url signup %}"><i class="icon-plus icon-white"></i> Signup</a>
          </li>
          {% else %}
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-asterisk icon-white"></i> Welcome, <strong class="white-text">{{ user.first_name }}</strong> <b class="caret"></b> </a>
            <ul class="dropdown-menu">
              <li>
                <a href="#"><i class="icon-cog"></i> Settings</a>
              </li>
              <li>
                <a href="#"><i class="icon-book"></i> Manual</a>
              </li>
              <li>
                <a href="#"><i class="icon-question-sign"></i> Support</a>
              </li>
              <li class="divider"></li>
              <li>
                <a href="{% url logout %}"><i class="icon-off"></i> Logout</a>
              </li>
            </ul>
          </li>
          {% endif %}
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>
</div>
<div id="report" class="modal hide fade" style="display: none; ">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">Ã—</a>
    {% if user.is_authenticated %} <h3>Thank You, {{ user.first_name }}!</h3>
    {% else %} <h3>Thank You!</h3>
    {% endif %}
  </div>
  <div class="modal-body">
    <form id="form-report" action="" method="post" class="form-vertical">
      {% csrf_token %}
      {% report_form %}
      {% for field in report_form %}
      <div id="form-report-{{ field.html_name }}" class="control-group">
        {{ field.label_tag }}
        <div class="controls">
          {{ field }}<span class="help-inline"></span>
        </div>
      </div>
      {% endfor %} <div id="form-report-error"></div>
    </form>
  </div>
  <div class="modal-footer">
    <a id="send-report-button" class="btn btn-danger" data-loading-text="Sending..." onclick="form_report();">Send Report</a>
    <a href="#" class="btn" data-dismiss="modal">Close</a>
  </div>
</div>
<script type="text/javascript" charset="utf-8">
	function form_report() {
		var form_id = 'form-report';
		form_data = $('#' + form_id).serializeObject(true);
		$('#send-report-button').button('loading');
		Dajaxice.Minerva.account.form_report(Dajax.process, {
			'form_data' : form_data,
			'form_id' : form_id
		});
	}

	function form_report_callback(data) {
		$('#send-report-button').button('reset');
		if(data.status == 'OK') {
			$('#form-report textarea').attr('value', '');
			$('#report').modal('hide');
		}
	}
</script>

{% extends "base.html" %}

{% load base_extra %}
{% load webdesign %}

{% block title %}{% brand_name %} - C.M.S.{% endblock %}

{% block content %}

<div class="page-header">
  <h1>Content Management System</h1>
</div>
<div class="row-fluid">
  <div class="span3">
    {% include "backstage/sidebar.html" %}
  </div>
  <div class="span9">
	<div id="admin-set">
		<div class="form-search row-fluid">
			<input id="frame-src" type="text" class="span11"></input>&nbsp;
			<a id="to-frame-src" class="btn"><i class="icon-share-alt"></i></a>
		</div>
		<div class="vertical-space"></div>
		<iframe id="admin" src="{{ admin_frame_location|safe }}"></iframe>
	</div>
	<div id="admin-new-window" class="hero-unit">
      <h1>Viewport Too Small!</h1>
      <p>
        Please click on the button below to open the Content Management System in a new window.
      </p>
      <p>
        <a href="/admin" class="btn btn-large btn-info" target="_blank">Open in New Window</a>
      </p>
    </div>
  </div>
</div>

<script type="text/javascript" charset="utf-8">
	$(document).ready(function() {
		
		$('#admin-new-window').hide();

		$('#admin').load(function() {
			frame_contents = $(this).contents();
			frame_src = frame_contents.get(0).location.href
			frame_html = frame_contents.find('html').html();
			$('#frame-src').val(frame_src);
            $.cookie('admin_frame_location', frame_src);
			frame_height = frame_contents.find("html").height();
			$(this).height(frame_height * 1.3);
        });
        
        function toggle_admin_view() {
			if ($(window).width() <= 979) {
				$('#admin-set').hide();
				$('#admin-new-window').show();
			}
			else {
				$('#admin-set').show();
				$('#admin-new-window').hide();
			}
		}
		
        toggle_admin_view();
		
        $(window).resize(function() {
		  toggle_admin_view();
		});
		
		$('#to-frame-src').click(function() {
			frame_contents = $('#admin').contents();
			frame_contents.get(0).location.href = $('#frame-src').val()
        });
		
	});
</script>

{% endblock %}
